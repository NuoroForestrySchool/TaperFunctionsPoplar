---
title: "Contrasting between- and within-rows stem profiles in poplar plantations - Avaiable data"
author: "Puletti N., Scotti R., ???"
date: june 2018
output:
  pdf_document:
    toc: true
---
  
# General scope
Assessment of poplar profiles sensitivity to competition anisotropy and to plantation density.
Three plots have been established in a poplar plantation of XX years in XXXXXX, where poplar rows are alternated with rows of other less fast growing species (XXX, XXX). Distance between the stems along the plantation rows are XXX m. Distances between the rows vary between the plots: 4 m, 4.5 m and 5 m. Hence the distances between the pollar rows are the double of these figures.
Each plot includes 12 stems from two facing rows.
Based on TLS data stem profiles from two orthogonal vertical crosssections have been determined: one along the rows direction and the other in between-rows direction.
Profiles have been sampled systematically adopting different segment lengths (Segm_lenght) estimating stem crosssection width (diam_btw_rows and diam_wti_rows) at different heigths along the stem (Sect_height)

[MEMO: credo sia opportuno ricordarsi di guardare
 Rubio-Cuadrado Á, Bravo-Oviedo A, Mutke S, Del Río M (2018). Climate effects on growth differ according to height and diameter
along the stem in Pinus pinaster Ait. iForest 11: 237-242. – doi: 10.3832/ifor2318-011 [online 2018-03-12]

# Setup and fetch the data

```{r read-data}
library(tidyverse)
library(magrittr)
library(ggplot2)
TLSderivedDiam <- read.csv("expData2.csv")

```
# Data synthesis
```{r}
library(knitr)
TLSderivedDiam %T>%
  str() %>%
  select(tesi, treid, length_toppo) %>%
  unique() %$%
  kable(table(tesi, treid), align = 'c', 
        caption = "Number of 'Segm_length' levels by tree")

TLSderivedDiam %>%
  select(length_toppo, slice) %>%
  unique() %$%
  kable(t(table(length_toppo)), align = 'c', 
        caption = "Number of measured sections by 'Sect_length' levels")

summarize_all_numeric <- function(df, stats = c("count.not.na", "min", "max"), ...) {
  count.not.na <- function(x) sum(!is.na(x))
  out <- cbind(stat = stats[1], summarize_if(df, is.numeric, stats[1], ...))
  for(s in stats[-1]) 
    out <- rbind(out, cbind(stat = s, summarize_if(df, is.numeric, s, ...)))
  return(out)
}

TLSderivedDiam %>% 
  summarize_all_numeric() %>%
  kable(align = 'c', caption = "Statistics for all numeric variables")

TLSderivedDiam %>% 
  select(- ends_with("centro")) %>%
  summarize_all_numeric(stats=c("min", "median", "mean", "max"), na.rm = T) %>%
  kable(align = 'c', caption = "Extended statistics for main numeric variables")


```


# Plot all profiles

```{r plot, fig.height=9, fig.width=7}
Diameters <- TLSderivedDiam %>% 
  select( -ends_with("centro")) %>% 
  filter(complete.cases(.)) %>%
  gather(direction, diam, starts_with("diam"))

gl <- Diameters %$%
  levels(tesi) %>%
  map(
    ~ Diameters %>%
      filter(tesi == .x) %>%
      ggplot(aes(slice, diam)) +
      geom_line(aes(color = direction)) +
      facet_grid(treid ~ length_toppo, scales = "free") +
      ggtitle(paste0("Tesis: '", .x, "'")) +
      theme(plot.title = element_text(hjust = 0.5))
  )
print(gl)

```

[rmarkdown::render("AvailableData.Rmd", encoding="UTF-8")]

